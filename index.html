<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebRTC 多功能房間</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <!-- 標題區 -->
    <div class="header">
      <h1>🚀 WebRTC 多功能房間</h1>
      <div class="room-info hidden" id="roomInfo">
        <span class="room-badge" id="roomIdDisplay"></span>
        <span class="member-count" id="memberCount" title="點擊查看成員">👥 1 人</span>
        <button class="btn btn-secondary" id="shareBtn">📤 分享</button>
        <button class="btn btn-secondary" id="leaveRoomBtn">🚪 離開房間</button>
      </div>
    </div>

    <!-- 大廳區 (開房/加入) -->
    <div class="lobby" id="lobby">
      <h2>開始使用 WebRTC 多功能房間</h2>
      <div class="lobby-buttons" id="createSection">
        <button class="btn btn-primary" id="createRoomBtn">🎯 建立房間</button>
      </div>
      <div class="lobby-buttons" id="joinSection">
        <input type="text" id="joinRoomId" placeholder="輸入房號">
        <button class="btn btn-primary" id="joinRoomBtn">🚀 加入房間</button>
      </div>
      <div class="qr-section" id="qrSection" style="display: none; justify-content: center; margin-top: 30px;">
        <canvas id="qrcode" width="200" height="200"></canvas>
        <div style="text-align: left;">
          <h3 style="color: #667eea; margin-bottom: 10px;">掃描 QR Code 加入</h3>
          <p style="color: #666;">其他人可以掃描此 QR Code<br>快速加入您的房間</p>
        </div>
      </div>
    </div>

    <!-- 主要內容區 -->
    <div class="main-content hidden" id="mainContent">
      <!-- 功能選單 -->
      <div class="feature-menu">
        <h3>功能選單</h3>
        <button class="feature-btn active" data-feature="chat">
          <span class="feature-icon">💬</span>
          <span>即時通訊</span>
        </button>
        <button class="feature-btn" data-feature="file">
          <span class="feature-icon">📁</span>
          <span>檔案傳輸</span>
        </button>
        <button class="feature-btn" data-feature="screen">
          <span class="feature-icon">🖥️</span>
          <span>串流投影</span>
        </button>
        <button class="feature-btn" data-feature="game">
          <span class="feature-icon">🎮</span>
          <span>互動娛樂</span>
        </button>
      </div>

      <!-- 功能內容區 -->
      <div class="feature-content">
        <!-- 即時通訊 -->
        <div id="chatFeature" class="feature-panel">
          <h2 style="margin-bottom: 20px; color: #667eea;">💬 即時通訊</h2>
          <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
              <div class="message received">
                <div class="message-sender">系統</div>
                <div>歡迎來到聊天室！</div>
              </div>
            </div>
            <div class="chat-input-area">
              <input type="text" id="chatInput" placeholder="輸入訊息...">
              <button class="btn btn-primary" id="sendBtn">發送</button>
            </div>
          </div>
        </div>

        <!-- 檔案傳輸 -->
        <div id="fileFeature" class="feature-panel hidden">
          <h2 style="margin-bottom: 20px; color: #667eea;">📁 檔案傳輸</h2>
          <div class="file-transfer">
            <div class="file-drop-zone" id="fileDropZone">
              <div style="font-size: 48px; margin-bottom: 15px;">📤</div>
              <h3 style="color: #667eea; margin-bottom: 10px;">拖曳檔案到此處</h3>
              <p style="color: #666;">或點擊選擇檔案</p>
              <input type="file" id="fileInput" multiple style="display: none;">
            </div>
            <div class="file-list" id="fileList"></div>
          </div>
        </div>

        <!-- 串流投影 -->
        <div id="screenFeature" class="feature-panel hidden">
          <h2 style="margin-bottom: 20px; color: #667eea;">🖥️ 串流投影</h2>
          <div class="screen-share">
            <div class="video-container" id="videoContainer">
              <video id="screenVideo" autoplay playsinline style="display: none;"></video>
              <div class="video-placeholder" id="videoPlaceholder">
                點擊下方按鈕開始分享螢幕
              </div>
            </div>
            <div class="screen-controls">
              <button class="btn btn-primary" id="startScreenBtn">🎬 開始分享螢幕</button>
              <button class="btn btn-secondary hidden" id="stopScreenBtn">⏹️ 停止分享</button>
            </div>
          </div>
        </div>

        <!-- 互動娛樂 -->
        <div id="gameFeature" class="feature-panel hidden">
          <h2 style="margin-bottom: 20px; color: #667eea;">🎮 互動娛樂</h2>
          <div class="games-container">
            <p style="color: #666; margin-bottom: 20px;">選擇一個遊戲與房間成員一起玩</p>
            <div class="game-grid">
              <div class="game-card" data-game="tic-tac-toe">
                <div class="game-icon">⭕</div>
                <div class="game-title">井字遊戲</div>
                <div class="game-desc">經典的圈圈叉叉對戰</div>
              </div>              
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 日誌區 -->
    <div class="log-container">
      <h3 style="color: #667eea; margin-bottom: 15px;">📋 系統日誌</h3>
      <pre id="log">等待操作...</pre>
    </div>

    <!-- 成員列表彈窗 -->
    <div id="memberModal" class="modal-overlay hidden">
      <div class="modal">
        <h2>
          <span>👥 房間成員</span>
          <button class="close-btn" id="closeMemberModal">✕</button>
        </h2>
        <div id="memberList"></div>
        <div class="edit-name-section">
          <h3>✏️ 修改我的顯示名稱</h3>
          <div class="edit-name-form">
            <input type="text" id="newNameInput" placeholder="輸入新名稱...">
            <button class="btn btn-primary" id="updateNameBtn">更新</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // 功能切換
    document.querySelectorAll('.feature-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.feature-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        const feature = btn.dataset.feature;
        document.querySelectorAll('.feature-panel').forEach(panel => {
          panel.classList.add('hidden');
        });
        document.getElementById(feature + 'Feature').classList.remove('hidden');
      });
    });

    // 聊天輸入
    const chatInput = document.getElementById('chatInput');
    chatInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        document.getElementById('sendBtn').click();
      }
    });
  </script>
  <!-- 專案入口 (main.js) -->
  <script type="module" src="main.js"></script>
</body>
</html>












